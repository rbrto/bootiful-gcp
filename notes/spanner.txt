# src/main/resources/db/schema.ddl

CREATE TABLE reservations (
  id        STRING (36) NOT NULL,
  name      STRING (255) NOT NULL
) PRIMARY KEY (id );



@Slf4j
@SpringBootApplication
public class SpannerApplication {

		private final ReservationRepository reservationRepository;

		SpannerApplication(ReservationRepository reservationRepository) {
				this.reservationRepository = reservationRepository;
		}

		@EventListener(ApplicationReadyEvent.class)
		public void setup() {

				// <1>
				this.reservationRepository.deleteAll();

				Stream
					.of("ray", "josh")
					.map(name -> new Reservation(UUID.randomUUID().toString(), name))
					.forEach(this.reservationRepository::save);
				this.reservationRepository.findAll().forEach(r -> log.info(r.toString()));
		}

		public static void main(String args[]) {
				SpringApplication.run(SpannerApplication.class, args);
		}
}

// <2>
@Data
@AllArgsConstructor
@NoArgsConstructor
@Table(name = "reservations")
class Reservation {

		@Id
		@PrimaryKey
		private String id;
		private String name;
}

// <3>
@RepositoryRestResource
interface ReservationRepository extends PagingAndSortingRepository<Reservation, String> {
}